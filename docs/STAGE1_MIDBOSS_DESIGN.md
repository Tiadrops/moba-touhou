# ステージ1 中ボス戦設計書 - ルーミア

## 1. 概要

### 1.1 基本情報
| 項目 | 値 |
|------|-----|
| ボス名 | ルーミア（Rumia） |
| タイトル | 「宵闇の妖怪」 |
| ステージ位置 | ステージ1 中ボス |
| 戦闘形式 | 1v1（ノーマル状態のみ） |

### 1.2 中ボス戦の特徴
- スペルカードなし（ノーマル状態のみ）
- QWEスキルを使用
- HP0で撃破、回復アイテムドロップ

---

## 2. ルーミアのステータス

### 2.1 基本ステータス
| ステータス | 値 | 備考 |
|-----------|-----|------|
| HP | 8000 | 中ボス基準 |
| 攻撃力(ATK) | 25 | スキルダメージ計算用 |
| 防御力(DEF) | 50 | 約33%ダメージ軽減 |
| 移動速度 | 120px/s | ゆっくり移動 |
| 当たり判定 | 半径40px | 円形 |

### 2.2 行動パターン
- プレイエリア上部1/3で左右に移動
- プレイヤーとの距離を一定に保つ
- スキル使用中は移動停止

---

## 3. スキル設計

### 3.1 Qスキル「月符・ムーンライトレイ」

| 項目 | 値 |
|------|-----|
| タイプ | 方向指定（自機狙い7way弾） |
| クールダウン | 4秒 |
| ダメージ | 30 + ATK × 0.5 = 42.5（1発あたり） |

**スキルステート:**
```
発動 → 詠唱中(0.4s) → モーション中(弾発射) → 終了
         ↓                ↓
      予告線表示        弾幕発射
         ↓                ↓
      スタンで中断     スタンで中断
```

**挙動:**
1. スキル発動と同時に予告線を表示（7本の赤線）
2. 詠唱0.4秒後、7way弾を発射開始
3. 各wayで10発の弾を数珠状に連射（0.05秒間隔）
4. 弾速: 10m/s = 550px/s
5. 弾サイズ: 半径8px
6. 詠唱中・モーション中にスタンで即中断

**パラメータ詳細:**
| パラメータ | 値 | 備考 |
|-----------|-----|------|
| 7way角度 | ±30度 | 中央を自機狙い、各10度間隔 |
| 弾数/way | 10発 | 計70発 |
| 発射間隔 | 0.05秒 | 数珠状に連なる |
| 弾速 | 550px/s | 10m/s |
| 予告線長さ | 600px | 画面端まで |

**ビジュアル:**
- 予告: 赤い細線（7本、扇状）
- 弾: 暗紫色の円形弾

```
[発射パターン - 7way × 10発の数珠弾]

        ●●●●●●●●●●
       ●●●●●●●●●●
      ●●●●●●●●●●
     ●●●●●●●●●●      → 自機方向
      ●●●●●●●●●●
       ●●●●●●●●●●
        ●●●●●●●●●●

※各wayが10発の数珠状に連なって発射
```

---

### 3.2 Wスキル「闇符・ダークサイドオブムーン」

| 項目 | 値 |
|------|-----|
| タイプ | 範囲攻撃（自身中心） |
| キャスト時間 | 0.5秒 |
| クールダウン | 8秒 |
| ダメージ | 50 + ATK × 0.8 = 70 |
| 範囲 | 半径200px |

**挙動:**
1. キャスト開始時、範囲予告を表示（暗い円形）
2. 0.5秒後、8方向に弾幕を放射
3. 各方向3発ずつ、計24発
4. 弾速: 300px/s
5. 弾サイズ: 半径10px

**ビジュアル:**
- 予告: 暗紫色の半透明円
- 弾: 黒と紫のグラデーション

```
[発射パターン - 8方向×3発]
        ●●●
      ↖  ↑  ↗
   ●●● ← ◆ → ●●●
      ↙  ↓  ↘
        ●●●
```

---

### 3.3 Eスキル「夜符・ナイトバード」

| 項目 | 値 |
|------|-----|
| タイプ | 移動スキル（ブリンク） |
| キャスト時間 | 0.2秒 |
| クールダウン | 10秒 |
| ダメージ | なし |
| 移動距離 | 150-250px（ランダム） |

**挙動:**
1. 短いキャスト後、ランダムな方向に瞬間移動
2. 移動先はプレイエリア内に制限
3. 移動後、0.3秒の硬直
4. 移動時に残像エフェクト

**ビジュアル:**
- 消失: 黒い霧のエフェクト
- 出現: 暗紫色のフェードイン

**使用条件:**
- HPが50%以下で使用可能になる
- プレイヤーとの距離が近い時に優先使用

---

## 4. AI行動ロジック

### 4.1 スキル優先度

```typescript
// 優先度判定（毎フレーム）
1. Eスキル: HP < 50% && プレイヤー距離 < 150px && CD完了
2. Wスキル: CD完了 && プレイヤー距離 < 250px
3. Qスキル: CD完了
4. 通常弾幕: 常時（2秒間隔）
```

### 4.2 移動AI

```typescript
// 移動パターン
- 基本: プレイエリア上部1/3で左右往復
- プレイヤー追跡: プレイヤーのX座標に緩やかに追従
- 距離維持: プレイヤーから200px以上を維持
```

### 4.3 フェーズ変化

| フェーズ | HP範囲 | 行動変化 |
|---------|--------|----------|
| Phase 1 | 100% - 50% | Q/Wスキルのみ、ゆっくり移動 |
| Phase 2 | 50% - 0% | E解禁、移動速度1.3倍、スキルCD0.8倍 |

---

## 5. 通常弾幕（スキル以外）

### 5.1 基本弾幕
| 項目 | 値 |
|------|-----|
| 発射間隔 | 2秒 |
| 弾数 | 3発（扇形） |
| 弾速 | 250px/s |
| ダメージ | 15 |

**パターン:**
- プレイヤー方向を中心に±15度の扇形
- Phase 2では5発（±30度）に増加

---

## 6. 撃破時の処理

### 6.1 ドロップアイテム
| アイテム | 確率 | 効果 |
|---------|------|------|
| HP回復（中） | 100% | HP +30 |
| スコアアイテム | 100% | +500点 ×3個 |
| パワーアップ | 50% | ATK +10% (30秒) |

### 6.2 演出
1. ルーミア消滅エフェクト（1秒）
2. アイテムが散らばる（上から落下）
3. 「中ボス撃破！」テキスト表示
4. 2秒後、道中Bへ移行

---

## 7. UI表示

### 7.1 ボスHP表示（EnemyZone）
```
┌─────────────────────────────────┐
│  ルーミア                        │
│  「宵闇の妖怪」                  │
│  ████████████░░░░░  75%         │
└─────────────────────────────────┘
```

### 7.2 スキルクールダウン表示
```
[Q] ████░░ 2.5s    [W] ██████ Ready    [E] ░░░░░░ 8.0s
```

- Ready: 緑色
- クールダウン中: 灰色 + 残り秒数
- キャスト中: 黄色点滅

---

## 8. 技術実装概要

### 8.1 新規ファイル

| ファイル | 役割 |
|---------|------|
| `src/entities/Boss.ts` | ボス基底クラス |
| `src/entities/bosses/Rumia.ts` | ルーミア固有実装 |
| `src/systems/BossAI.ts` | ボスAI制御 |
| `src/systems/EnemySkillSystem.ts` | 敵スキル管理 |
| `src/stages/Stage1.ts` | ステージ1定義 |
| `src/stages/StageManager.ts` | ステージ進行管理 |

### 8.2 既存ファイルの修正

| ファイル | 修正内容 |
|---------|----------|
| `GameScene.ts` | StageManager統合 |
| `EnemyZone.ts` | スキルCD表示追加 |
| `GameConfig.ts` | ルーミアスキル設定追加 |
| `CharacterData.ts` | ルーミアデータ追加 |
| `types/index.ts` | ボス/スキル型定義追加 |

### 8.3 クラス構造

```
Boss (abstract)
  ├── hp, maxHp, defense, atk
  ├── skills: EnemySkill[]
  ├── currentPhase: number
  ├── update(): void
  ├── useSkill(slot): void
  └── abstract initSkills(): void

Rumia extends Boss
  ├── initSkills(): void  // Q/W/E定義
  ├── updateAI(): void    // 行動決定
  └── onPhaseChange(): void
```

---

## 9. 戦闘開始演出

### 9.1 登場シーケンス
1. 画面上部から黒い霧が降りてくる（1秒）
2. 霧の中からルーミアが出現
3. 名前テキスト表示「ルーミア - 宵闘の妖怪」
4. EnemyZoneにHP/スキル表示開始
5. 1秒後、戦闘開始

---

## 10. バランス調整用パラメータ

```typescript
// GameConfig.ts に追加
BOSS_CONFIG: {
  RUMIA: {
    HP: 8000,
    ATK: 25,
    DEF: 50,
    MOVE_SPEED: 120,

    SKILL_Q: {
      DAMAGE_BASE: 30,
      DAMAGE_RATIO: 0.5,
      COOLDOWN: 4000,
      CAST_TIME: 300,
      BULLET_COUNT: 5,
      BULLET_SPEED: 400,
      BULLET_INTERVAL: 100,
    },

    SKILL_W: {
      DAMAGE_BASE: 50,
      DAMAGE_RATIO: 0.8,
      COOLDOWN: 8000,
      CAST_TIME: 500,
      BULLET_COUNT: 24,  // 8方向 × 3発
      BULLET_SPEED: 300,
      RANGE: 200,
    },

    SKILL_E: {
      COOLDOWN: 10000,
      CAST_TIME: 200,
      BLINK_DISTANCE_MIN: 150,
      BLINK_DISTANCE_MAX: 250,
      HP_THRESHOLD: 0.5,  // 50%以下で解禁
    },

    PHASE2_HP_THRESHOLD: 0.5,
    PHASE2_SPEED_MULT: 1.3,
    PHASE2_CD_MULT: 0.8,
  }
}
```

---

## 変更履歴

| 日付 | 変更内容 |
|------|----------|
| 2025-12-07 | 初版作成 |
